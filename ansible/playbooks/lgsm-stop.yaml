---
# Stop LGSM Game Server
#
# Variables:
#   - server_id: Unique server identifier
#   - game_id: Game identifier
#   - lgsm_server_name: LGSM server name

- name: Stop LGSM Game Server
  hosts: all
  become: yes
  vars:
    server_user: "gs_{{ server_id | regex_replace('-', '') | truncate(8, True, '') }}"
    server_home: "/opt/gameservers/{{ game_id }}/{{ server_id }}"

  tasks:
    - name: Stop game server via LGSM
      become_user: "{{ server_user }}"
      command: "./{{ lgsm_server_name }} stop"
      args:
        chdir: "{{ server_home }}"
      register: stop_result
      failed_when: false  # LGSM returns non-zero if already stopped

    - name: Display stop result
      debug:
        msg: "{{ stop_result.stdout_lines | default([]) }}"
      when: stop_result.stdout_lines is defined
